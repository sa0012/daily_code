<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Document</title>
  </head>
  <body>
    简化版本promise
  </body>
</html>

<script src="index.js"></script>

<!-- <script>
  // promise 三个状态常量
  const PENDING = "pending";
  const RESOLVED = "resolved";
  const REJECTED = "rejected";
  function MyPromise(fn) {
    const _this = this;
    // 初始化
    _this.state = PENDING;
    _this.value = null;
    _this.resolvedCallbacks = [];
    _this.rejectedCallbacks = [];

    // resolve函数
    function resolve(value) {
      if (_this.state === PENDING) {
        _this.state = RESOLVED;
        _this.value = value;
        _this.resolvedCallbacks.map(cb => cb(_this.value));
      }
    }

    // reject函数
    function reject(value) {
      if (_this.state === PENDING) {
        _this.state = REJECTED;
        _this.value = value;
        _this.rejectedCallbacks.map(cb => cb(_this.value));
      }
    }
    // 当创建对象的时候，执行传进来的执行器函数
    // 并且传递resolve和reject函数
    try {
      fn(resolve, reject);
    } catch (e) {
      reject(e);
    }
  }

  // 为promise原型链添加then函数
  MyPromise.prototype.then = function(onFulfilled, onRejected) {
    const _this = this;
    onFulfilled = typeof onFulfilled === "function" ? onFulfilled : v => v;
    onRejected =
      typeof onRejected === "function"
        ? onRejected
        : err => {
            throw err;
          };

    // 处理resolve, reject
    if (_this.state === PENDING) {
      _this.resolvedCallbacks.push(onFulfilled);
      _this.rejectedCallbacks.push(onRejected);
    }

    if (_this.state === RESOLVED) {
      onFulfilled(_this.value);
    }

    if (_this.state === REJECTED) {
      onRejected(_this.value);
    }

    return _this;
  };
</script> -->
